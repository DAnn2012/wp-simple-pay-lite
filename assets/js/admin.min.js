/*! WP Simple Pay Lite for Stripe - 2.0.4
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media 2017
 * Licensed GPLv2+ */

var spAdmin={};!function(i){"use strict";var e,n=i(document.body);spAdmin={init:function(){e=n.find("#simpay-form-settings"),this.setupChosen(),this.addMediaFields(),this.handleMetaboxTabClick(),e.find(".simpay-tab-link").on("click.simpayTabLink",function(e){e.preventDefault(),spAdmin.handleInternalLinkToTabClicks(i(this))}),e.on("click.simpayImagePreview",".simpay-remove-image-preview",function(i){spAdmin.handleRemoveImagePreviewClick(i)}),e.find(".simpay-panel-field").on("click.simpaySectionToggle",".simpay-section-toggle",function(e){spAdmin.initSectionToggle(i(this))}),n.find(".simpay-button").on("click.simpayShowSpinner",function(e){spAdmin.showSpinner(i(this))}),n.find("#simpay-preview-button").on("click.simpayPreviewButton",function(e){spAdmin.handlePreviewButton(i(this),e)}),n.find("#post").on("keypress.simpaySubmitOnEnter",function(e){spAdmin.handleSubmitOnEnter(i(this))}),e.find('.simpay-multi-toggle input[type="radio"]:checked').each(function(){spAdmin.initMultiToggle(i(this))}),e.on("change.simpayMultiToggle",'.simpay-multi-toggle input[type="radio"]',function(){spAdmin.initMultiToggle(i(this))}),n.trigger("simpayAdminInit")},handleSubmitOnEnter:function(i){var e,n,t;13===(event.keyCode?event.keyCode:event.which)&&(n=(e=i.closest("form")).find("#save-post"),t=e.find("#publish"),n.length>0?n.click():t.click())},handlePreviewButton:function(i,e){var n,t;e.preventDefault(),n=(t=i.closest("form")).attr("action"),t.attr("action",i.data("action")),t.attr("target","_blank"),t.submit(),t.attr("action",n),t.attr("target","")},showSpinner:function(i){i.parent().find(".spinner").css("visibility","visible")},handleRemoveImagePreviewClick:function(i){i.preventDefault(),e.find(".simpay-image-preview-wrap").hide(),e.find("#_image_url").val("")},addMediaFields:function(){var e;i(".simpay-media-uploader").on("click",function(n){n.preventDefault(),window.simpayMediaUploaderInputField=i(this),e?e.open():((e=wp.media.frames.file_frame=wp.media({title:spGeneral.i18n.mediaTitle,button:{text:spGeneral.i18n.mediaButtonText},multiple:!1})).on("select",function(){var n=e.state().get("selection").first().toJSON(),t=window.simpayMediaUploaderInputField.prev(),a="id"===t.data("fvalue")?n.id:n.url;i(".simpay-image-preview-wrap").show(),i(".simpay-image-preview").prop("src",a),t.val(a)}),e.open())})},setupChosen:function(){var e=i(".simpay-chosen-select, .simpay-chosen-search");e.chosen({disable_search_threshold:20}),e.chosen()},handleMetaboxTabClick:function(){var e=i("ul.simpay-tabs a"),n=i("div.simpay-panel"),t=e.parents("li"),a={};e.on("click",function(e){var a=i(this).parent(),s=i(i(this).attr("href"));location.hash=i(this).attr("href"),e.preventDefault(),t.removeClass("active"),a.addClass("active"),n.addClass("simpay-panel-hidden"),s.removeClass("simpay-panel-hidden"),e.stopPropagation()}),location.hash.length&&(setTimeout(function(){window.scrollTo(0,0)},1),(a=i('ul.simpay-tabs a[href="'+location.hash+'"]')).length&&a.click())},handleInternalLinkToTabClicks:function(i){var e=i.data("show-tab");n.find("."+e+"-tab a").click()},initSectionToggle:function(i){var e=i.data("show");i.is(":checked")?i.closest(".simpay-panel-field").parent().find(e).show():i.closest(".simpay-panel-field").parent().find(e).hide()},initMultiToggle:function(n){var t=n.attr("id");n.closest(".simpay-field-radios-inline").find('input[type="radio"]').each(function(n){e.find(".toggle-"+i(this).attr("id")).hide()}),e.find(".toggle-"+t).show()}},i(document).ready(function(i){spAdmin.init()})}(jQuery);